# Еще немного компонентов и простых приложений

В этой главе мы будем работать с более сложным примером — программе по статистике продаж, описанным в (Ливенворт 1977). В упомянутом документе описывается приложение, в котором отсортированный файл сведений о продажах продуктов сравнивается с мастер-файлом продукта, создавая обновленный мастер-файл и два отчета: сводку по продуктам и сводку по районам и продавцам. Рисунок на следующей странице, который первоначально появился в (Моррисон 1978), показывает сеть FBP-процессов для этого приложения.

При традиционном подходе к созданию этого приложения мы сначала разделили бы сводку по району/продавцу на отдельный этап работы, которому предшествовала бы сортировка. Получилась бы функция, которая принимает два входных файла и генерирует три выходных (обновленный мастер, сводка продукта и ввод для сортировки, также называемый расширенными деталями). Эта функция должна передавать сведения о мастер-файлах, учитывать, что один из файлов обычно заканчивается раньше другого и обрабатывать возможные прерывания, обнаруживать нарушения последовательности и т.д. и т.п.

Как мы говорили в предыдущей главе, компонент `Collate` является ключом к упрощению такого рода приложений. Результирующая диаграмма выглядит следующим образом:

![fig10.1](http://www.jpaulmorrison.com/fbp/Fig10.1.gif)

Фрагмент 10.1

Где:

- `R` является компонентом чтения.
- `W` — компонент записи.
- `COL` — это обобщенный `Collate`, который объединяет два или более потока на основе заданных контрольных полей и вставляет IP-скобки между IP с разными значениями в контрольных полях. (Если используется только с одним потоком, то просто вставляет IP скобок — это случай второго `COL` на диаграмме).
- `P` является компонентом печати.
- `TR1` и `TR2` соответствуют Tran-1 и Tran-2 соответственно в статье Б. Ливенворта.
- `SRT` - это обобщенный компонент «Сортировка», который сортирует расширенные сведения, поступающие из Tran-1, по продавцам в пределах округа.

Выходные данные компонента `Collate` состоят из последовательностей групп, называемых «подпотоками», каждая из которых состоит из открывающей скобки, "мастера", нуля или более деталей и закрывающей скобки.

Схематично это можно показать следующим образом:

![fig10.2](http://www.jpaulmorrison.com/fbp/Fig10.2.gif)

Фрагмент 10.2

J-D. Warnier (1974) использует вертикальную форму приведенной выше диаграммы для определения входных и выходных файлов приложения и использует ее для определения структуры кода, который должен их обрабатывать. К сожалению, программирование с управлением потока требует, чтобы один из файлов становился "драйвером" с точки зрения общей структуры программы, так что, если между структурами разных файлов есть какие-либо существенные различия, структуру программы становится все труднее и труднее понимать и, как следствие, поддерживать. В FBP эта структура сообщает нам важные вещи именно о тех компонентах, которые получают или отправляют этот конкретный поток и потому остается чрезвычайно полезным средством для понимания логики приложения.

Входной поток для `TR1` показан с использованием расширения нотации J-D Warnier:

![fig10.3](http://www.jpaulmorrison.com/fbp/Fig10.3.gif)

Фрагмент 10.3

